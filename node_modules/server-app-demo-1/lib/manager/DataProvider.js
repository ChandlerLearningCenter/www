/*global console2, setTimeout, require */

Ext.define('demo1.manager.DataProvider', {
    extend: 'Ext.ux.app.Manager',

    initialize: function(o){
        
        // instantate a randomizer for demo purposes
        this.rnd = new Ext.ux.data.Randomizer();
        
        this.handleSuccess(o);
    },


    // note: this is generating random data and simulating an asynchronous call
    //       for testing purposes, failure is an option.  latency too.
    getUserList: function(o){
        var me = this,
            rnd = this.rnd,
            latency; 
    
        function handleContinuation(){
            var list, item, itemCount, i;
            
            // simulate a failure 10% of the time
            if(rnd.getBoolean(0.1)){
                return me.handleFailure(o, 'Randomly simulated failure');
            }
 
            // generate random data.  list could be empty.
            list = [];
            itemCount = rnd.getInt(0, 10);
            for(i=0; i<itemCount; i++){
                item = {
                    id: rnd.getIntID(10000, 99999),
                    name: rnd.getWord(6, 18),
                    emailAddress: rnd.getEmailAddress()
                };
                list.push(item);
            }
            
            // successful return
            me.handleSuccess(o, list);
        }
             
        // sometimes things take time.  simulate latency
        latency = rnd.getInt(0, 200);  
        if(latency){
            setTimeout(handleContinuation, latency);
        }else{
            handleContinuation();
        }
    },
    
    

    
    the: 'end'
});